<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>BasqueTimeZoneNameProvider.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">basque-locale-extension</a> &gt; <a href="index.source.html" class="el_package">dev.orne.i18n.spi.eu</a> &gt; <span class="el_source">BasqueTimeZoneNameProvider.java</span></div><h1>BasqueTimeZoneNameProvider.java</h1><pre class="source lang-java linenums">package dev.orne.i18n.spi.eu;

/*-
 * #%L
 * basque-locale-extension
 * %%
 * Copyright (C) 2024 Orne Developments
 * %%
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation, either version 3 of the
 * License, or (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Lesser Public License for more details.
 * 
 * You should have received a copy of the GNU General Lesser Public
 * License along with this program.  If not, see
 * &lt;http://www.gnu.org/licenses/lgpl-3.0.html&gt;.
 * #L%
 */

import java.io.IOException;
import java.io.InputStream;
import java.text.DateFormatSymbols;
import java.time.ZoneId;
import java.time.zone.ZoneRulesException;
import java.util.HashMap;
import java.util.Locale;
import java.util.Properties;
import java.util.TimeZone;
import java.util.logging.Level;
import java.util.logging.Logger;
import java.util.spi.TimeZoneNameProvider;

import javax.validation.constraints.NotNull;

/**
 * Basque time zone name provider.
 * 
 * @author &lt;a href=&quot;https://github.com/ihernaez&quot;&gt;(w) Iker Hernaez&lt;/a&gt;
 * @version 1.0, 2024-10
 * @since 1.0
 */
public class BasqueTimeZoneNameProvider
extends TimeZoneNameProvider {

    /** The logger of the class. */
<span class="fc" id="L51">    private static final Logger LOG = Logger.getLogger(BasqueTimeZoneNameProvider.class.getName());</span>

    /** Time zone standard name property suffix. */
    static final String STANDARD_SUFFIX = &quot;.std&quot;;
    /** Time zone daylight saving time name property suffix. */
    static final String DAYLIGHT_SUFFIX = &quot;.dst&quot;;
    /** Time zone long name property suffix. */
    static final String LONG_SUFFIX = &quot;.long&quot;;

    /** The time zone names in {@code DateFormatSymbols} format. */
    private static String[][] names;
    /** The time zone aliases. */
<span class="fc" id="L63">    private final HashMap&lt;String, String&gt; aliases = new HashMap&lt;&gt;();</span>
    /** The time zone names by zone ID. */
<span class="fc" id="L65">    private final HashMap&lt;String, String[]&gt; index = new HashMap&lt;&gt;();</span>

    /**
     * Creates a new instance.
     */
    public BasqueTimeZoneNameProvider() {
<span class="fc" id="L71">        super();</span>
<span class="fc bfc" id="L72" title="All 2 branches covered.">        for (final String[] zone : getNames()) {</span>
<span class="fc" id="L73">            index.put(zone[0], zone);</span>
        }
<span class="fc" id="L75">        aliases.put(&quot;GMT0&quot;, &quot;GMT&quot;);</span>
<span class="fc" id="L76">        aliases.put(&quot;Etc/GMT0&quot;, &quot;GMT&quot;);</span>
<span class="fc" id="L77">    }</span>

    /**
     * {@inheritDoc}
     */
    @Override
    public String getDisplayName(
            final @NotNull String id,
            final boolean daylight,
            final int style,
            final @NotNull Locale locale) {
<span class="fc" id="L88">        final String[] zone = getNames(id);</span>
<span class="fc bfc" id="L89" title="All 2 branches covered.">        if (zone == null) {</span>
<span class="fc" id="L90">            return null;</span>
        }
<span class="fc bfc" id="L92" title="All 2 branches covered.">        if (daylight) {</span>
<span class="fc bfc" id="L93" title="All 2 branches covered.">            if (style == TimeZone.LONG) {</span>
<span class="fc" id="L94">                return zone[3];</span>
            } else {
<span class="fc" id="L96">                return zone[4];</span>
            }
        } else {
<span class="fc bfc" id="L99" title="All 2 branches covered.">            if (style == TimeZone.LONG) {</span>
<span class="fc" id="L100">                return zone[1];</span>
            } else {
<span class="fc" id="L102">                return zone[2];</span>
            }
        }
    }

    @Override
    public String getGenericDisplayName(
            final String id,
            final int style,
            final Locale locale) {
<span class="fc" id="L112">        final String[] zone = getNames(id);</span>
<span class="pc bpc" id="L113" title="1 of 4 branches missed.">        if (zone == null || zone.length &lt; 7) {</span>
<span class="fc" id="L114">            return null;</span>
        }
<span class="fc bfc" id="L116" title="All 2 branches covered.">        if (style == TimeZone.LONG) {</span>
<span class="fc" id="L117">            return zone[5];</span>
        } else {
<span class="fc" id="L119">            return zone[6];</span>
        }
    }

    /**
     * {@inheritDoc}
     */
    @Override
    public @NotNull Locale[] getAvailableLocales() {
<span class="fc" id="L128">        return BasqueLocaleServiceProvider.LOCALES;</span>
    }

    /**
     * Returns The time zone names in {@code DateFormatSymbols} format.
     * 
     * @return The time zone names in {@code DateFormatSymbols} format.
     * @see DateFormatSymbols#getZoneStrings()
     */
    static synchronized @NotNull String[][] getNames() {
<span class="fc bfc" id="L138" title="All 2 branches covered.">        if (names == null) {</span>
<span class="fc" id="L139">            final Properties translations = new Properties();</span>
<span class="fc" id="L140">            try (InputStream is = BasqueLocaleNameProvider.class.getResourceAsStream(&quot;timezones.properties&quot;)) {</span>
<span class="fc" id="L141">                translations.load(is);</span>
<span class="nc" id="L142">            } catch (final IOException e) {</span>
<span class="nc" id="L143">                LOG.log(Level.SEVERE, &quot;Error loading basque time zones names&quot;, e);</span>
<span class="fc" id="L144">            }</span>
<span class="fc" id="L145">            names = ((DateFormatSymbols) DateFormatSymbols.getInstance(Locale.ENGLISH).clone())</span>
<span class="fc" id="L146">                    .getZoneStrings();</span>
<span class="fc bfc" id="L147" title="All 2 branches covered.">            for (int i = 0; i &lt; names.length; i++) {</span>
<span class="fc" id="L148">                final String[] zone = names[i];</span>
<span class="fc" id="L149">                zone[1] = translations.getProperty(zone[0] + STANDARD_SUFFIX + LONG_SUFFIX, zone[1]);</span>
<span class="fc" id="L150">                zone[2] = translations.getProperty(zone[0] + STANDARD_SUFFIX, zone[2]);</span>
<span class="fc" id="L151">                zone[3] = translations.getProperty(zone[0] + DAYLIGHT_SUFFIX + LONG_SUFFIX, zone[3]);</span>
<span class="fc" id="L152">                zone[4] = translations.getProperty(zone[0] + DAYLIGHT_SUFFIX, zone[4]);</span>
<span class="pc bpc" id="L153" title="1 of 2 branches missed.">                if (zone.length &gt; 5) {</span>
<span class="fc" id="L154">                    zone[5] = translations.getProperty(zone[0] + LONG_SUFFIX, zone[5]);</span>
                }
<span class="pc bpc" id="L156" title="1 of 2 branches missed.">                if (zone.length &gt; 6) {</span>
<span class="fc" id="L157">                    zone[6] = translations.getProperty(zone[0], zone[6]);</span>
                }
            }
        }
<span class="fc" id="L161">        return names;</span>
    }

    /**
     * Retrieves the time zone names for the specified ID, trying 
     * 
     * @param id The time zone ID.
     * @return The time zone names in {@code DateFormatSymbols} format, if found.
     */
    private String[] getNames(
            final @NotNull String id) {
<span class="fc" id="L172">        String[] zone = this.index.get(this.aliases.getOrDefault(id, id));</span>
<span class="fc bfc" id="L173" title="All 2 branches covered.">        if (zone == null) {</span>
            try {
<span class="nc" id="L175">                zone = this.index.get(ZoneId.of(id).normalized().getId());</span>
<span class="fc" id="L176">            } catch (final ZoneRulesException ignore) {</span>
                // Ignore
<span class="nc" id="L178">            }</span>
        }
<span class="fc" id="L180">        return zone;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>